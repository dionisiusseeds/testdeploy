import { circleTop } from '@/repository/asset.repository';
import { Typography } from '@material-tailwind/react';
import { useEffect, useState } from 'react';

interface circleInterface {
  id: string;
  image: string;
  banner: string;
  name: string;
  is_liked: number;
  total_like: number;
  totalMember: number;
  totalRating: number;
  totalPost: number;
}
export default function CardCircle(): React.ReactElement {
  const [circle, setCircle] = useState<circleInterface[]>();
  const [isLoadingCircle, setIsLoadingCircle] = useState(false);

  const fetchTopCircle = async (): Promise<void> => {
    try {
      setIsLoadingCircle(true);
      circleTop()
        .then(res => {
          setCircle(res.result);
          setIsLoadingCircle(false);
        })
        .catch(err => {
          console.log(err);
          setIsLoadingCircle(false);
        });
    } catch (error: any) {
      setIsLoadingCircle(false);
      console.error('Error fetching circle data:', error.message);
    }
  };

  function isImageUrlValid(url: string): boolean {
    return (
      (url?.startsWith('http://') || url?.startsWith('https://')) &&
      !url?.startsWith(
        'https://seeds-bucket-new.s3.ap-southeast-3.amazonaws.com'
      )
    );
  }

  useEffect(() => {
    fetchTopCircle()
      .then()
      .catch(() => {});
  }, []);

  return (
    <>
      {circle !== undefined && (
        <>
          {isLoadingCircle ? (
            <Typography className="w-full text-base font-semibold text-center">
              Loading....
            </Typography>
          ) : circle.length !== 0 ? (
            circle.map((data, idx) => {
              const defaultCircle = '/assets/default-circle.png';
              const imageUrl = data?.banner ?? defaultCircle;
              const isImageValid = isImageUrlValid(imageUrl);
              return (
                <div
                  key={idx}
                  className="relative border border-black/10 rounded-[26px] bg-[url] w-full h-[220px] my-4"
                >
                  {isImageValid ? (
                    <img
                      src={`${data.banner}`}
                      alt={data?.name}
                      className="absolute w-full xl:h-full h-full object-fill rounded-[26px] brightness-50"
                    />
                  ) : (
                    <img
                      src={defaultCircle}
                      alt={data?.name}
                      className="absolute w-full xl:h-full h-full object-fill rounded-[26px] brightness-50"
                    />
                  )}
                  <div className="relative z-10 xl:pt-[20px] pt-6 w-full xl:h-[175px] h-full rounded-[26px]">
                    <img
                      src={data.image}
                      className="w-[82px] h-[82px] mx-auto border-4 border-white rounded-full"
                    />
                    <h1 className="text-lg font-semibold text-white text-center">
                      {data.name}
                    </h1>
                    <div className="flex flex-row justify-center mt-4 gap-5">
                      <section className="flex flex-row gap-2">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="23"
                          height="23"
                          viewBox="0 0 23 23"
                          fill="none"
                        >
                          <path
                            d="M14.4046 9.87643L13.4973 9.72551C13.4754 9.85728 13.4825 9.99224 13.518 10.121C13.5535 10.2498 13.6166 10.3693 13.7029 10.4712C13.7893 10.5731 13.8968 10.655 14.0179 10.7112C14.1391 10.7674 14.2711 10.7966 14.4046 10.7966V9.87643ZM4.2825 9.87643V8.95623C4.03845 8.95623 3.80439 9.05318 3.63182 9.22575C3.45925 9.39832 3.3623 9.63237 3.3623 9.87643H4.2825ZM6.12289 19.9986H16.5763V18.1582H6.12289V19.9986ZM17.6805 8.95623H14.4046V10.7966H17.6805V8.95623ZM15.3129 10.0273L16.0536 5.57819L14.239 5.27545L13.4973 9.72551L15.3129 10.0273ZM14.239 3.43506H14.0421V5.27545H14.239V3.43506ZM10.9788 5.07393L8.66447 8.54674L10.1957 9.56816L12.5109 6.09534L10.9788 5.07393ZM7.89887 8.95623H4.2825V10.7966H7.89887V8.95623ZM3.3623 9.87643V17.238H5.2027V9.87643H3.3623ZM19.2835 17.7791L20.3878 12.2579L18.5842 11.8972L17.4799 17.4183L19.2835 17.7791ZM8.66447 8.54674C8.58041 8.67273 8.46656 8.77603 8.333 8.84746C8.19945 8.91889 8.05033 8.95625 7.89887 8.95623V10.7966C8.35332 10.7966 8.80074 10.6844 9.20141 10.4699C9.60208 10.2554 9.9436 9.94538 10.1957 9.56724L8.66447 8.54582V8.54674ZM16.0536 5.57819C16.0976 5.31459 16.0836 5.04458 16.0127 4.78693C15.9418 4.52927 15.8156 4.29016 15.6429 4.0862C15.4702 3.88225 15.2551 3.71836 15.0127 3.60591C14.7703 3.49346 14.5063 3.43516 14.239 3.43506V5.27545L16.0536 5.57819ZM17.6805 10.7966C17.8167 10.7966 17.9512 10.8267 18.0743 10.8849C18.1974 10.9432 18.306 11.028 18.3924 11.1332C18.4787 11.2385 18.5407 11.3617 18.5737 11.4938C18.6067 11.6259 18.6109 11.7636 18.5842 11.8972L20.3878 12.2579C20.4678 11.8575 20.458 11.4443 20.3591 11.0481C20.2602 10.6519 20.0746 10.2826 19.8157 9.9668C19.5569 9.65099 19.2312 9.39654 18.8621 9.22179C18.493 9.04704 18.0898 8.95634 17.6815 8.95623V10.7966H17.6805ZM16.5763 19.9986C17.2146 19.9986 17.8331 19.7775 18.3267 19.3728C18.8203 18.9681 19.1584 18.4049 19.2835 17.7791L17.4799 17.4183C17.4382 17.6272 17.3253 17.8151 17.1605 17.95C16.9958 18.0849 16.7893 18.1585 16.5763 18.1582V19.9986ZM14.0421 3.43506C13.436 3.43492 12.8393 3.58443 12.3049 3.87033C11.7705 4.15623 11.315 4.56967 10.9788 5.07393L12.5109 6.09534C12.6789 5.84319 12.9066 5.63643 13.1737 5.4934C13.4408 5.35037 13.7391 5.2755 14.0421 5.27545V3.43506ZM6.12289 18.1582C5.87884 18.1582 5.64478 18.0612 5.47221 17.8887C5.29964 17.7161 5.2027 17.482 5.2027 17.238H3.3623C3.3623 17.9701 3.65315 18.6723 4.17086 19.19C4.68857 19.7077 5.39074 19.9986 6.12289 19.9986V18.1582Z"
                            fill="#3AC4A0"
                          />
                          <path
                            d="M7.96338 9.87622V19.0782"
                            stroke="#3AC4A0"
                            strokeWidth="2.20847"
                          />
                        </svg>
                        <h1 className="text-lg font-semibold text-white text-center">
                          {data.total_like}
                        </h1>
                      </section>
                      <section className="flex flex-row gap-2">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="23"
                          height="23"
                          viewBox="0 0 23 23"
                          fill="none"
                        >
                          <g clip-path="url(#clip0_39_16015)">
                            <path
                              fill-rule="evenodd"
                              clip-rule="evenodd"
                              d="M1.70111 14.9045C2.56396 14.0416 3.73424 13.5569 4.95449 13.5569H12.3161C13.5363 13.5569 14.7066 14.0416 15.5694 14.9045C16.4323 15.7673 16.917 16.9376 16.917 18.1579V19.9983C16.917 20.5065 16.505 20.9184 15.9968 20.9184C15.4886 20.9184 15.0766 20.5065 15.0766 19.9983V18.1579C15.0766 17.4257 14.7858 16.7235 14.2681 16.2058C13.7504 15.6881 13.0482 15.3973 12.3161 15.3973H4.95449C4.22234 15.3973 3.52017 15.6881 3.00246 16.2058C2.48475 16.7235 2.19391 17.4257 2.19391 18.1579V19.9983C2.19391 20.5065 1.78192 20.9184 1.27371 20.9184C0.765501 20.9184 0.353516 20.5065 0.353516 19.9983V18.1579C0.353516 16.9376 0.83826 15.7673 1.70111 14.9045Z"
                              fill="#3AC4A0"
                            />
                            <path
                              fill-rule="evenodd"
                              clip-rule="evenodd"
                              d="M8.63564 4.35504C7.11101 4.35504 5.87506 5.591 5.87506 7.11563C5.87506 8.64025 7.11101 9.87621 8.63564 9.87621C10.1603 9.87621 11.3962 8.64025 11.3962 7.11563C11.3962 5.591 10.1603 4.35504 8.63564 4.35504ZM4.03467 7.11563C4.03467 4.57458 6.09459 2.51465 8.63564 2.51465C11.1767 2.51465 13.2366 4.57458 13.2366 7.11563C13.2366 9.65668 11.1767 11.7166 8.63564 11.7166C6.09459 11.7166 4.03467 9.65668 4.03467 7.11563Z"
                              fill="#3AC4A0"
                            />
                            <path
                              fill-rule="evenodd"
                              clip-rule="evenodd"
                              d="M17.8664 14.3666C17.9934 13.8746 18.4953 13.5787 18.9874 13.7057C19.9744 13.9606 20.8489 14.536 21.4735 15.3417C22.0981 16.1474 22.4374 17.1377 22.4381 18.1572L22.4381 19.9982C22.4381 20.5064 22.0261 20.9184 21.5179 20.9184C21.0097 20.9184 20.5977 20.5064 20.5977 19.9982L20.5977 18.1585C20.5977 18.1584 20.5977 18.1586 20.5977 18.1585C20.5972 17.547 20.3936 16.9526 20.0189 16.4693C19.6442 15.9859 19.1195 15.6406 18.5273 15.4877C18.0352 15.3606 17.7393 14.8587 17.8664 14.3666Z"
                              fill="#3AC4A0"
                            />
                            <path
                              fill-rule="evenodd"
                              clip-rule="evenodd"
                              d="M14.1852 3.32621C14.3113 2.83388 14.8126 2.53695 15.3049 2.66301C16.2946 2.91641 17.1718 3.49199 17.7982 4.29902C18.4246 5.10604 18.7647 6.09859 18.7647 7.12021C18.7647 8.14182 18.4246 9.13438 17.7982 9.9414C17.1718 10.7484 16.2946 11.324 15.3049 11.5774C14.8126 11.7035 14.3113 11.4065 14.1852 10.9142C14.0592 10.4219 14.3561 9.92058 14.8484 9.79453C15.4422 9.64249 15.9686 9.29714 16.3444 8.81292C16.7203 8.32871 16.9243 7.73317 16.9243 7.12021C16.9243 6.50724 16.7203 5.91171 16.3444 5.42749C15.9686 4.94328 15.4422 4.59793 14.8484 4.44589C14.3561 4.31983 14.0592 3.81853 14.1852 3.32621Z"
                              fill="#3AC4A0"
                            />
                          </g>
                          <defs>
                            <clipPath id="clip0_39_16015">
                              <rect
                                width="22.0847"
                                height="22.0847"
                                fill="white"
                                transform="translate(0.353516 0.674072)"
                              />
                            </clipPath>
                          </defs>
                        </svg>
                        <h1 className="text-lg font-semibold text-white text-center">
                          {data.totalMember}
                        </h1>
                      </section>
                      <section className="flex flex-row gap-2">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="23"
                          height="23"
                          viewBox="0 0 23 23"
                          fill="none"
                        >
                          <path
                            d="M17.209 22.6489H5.23274C3.58463 22.6489 2.22949 21.2938 2.22949 19.6457V3.67729C2.22949 2.02918 3.58463 0.674072 5.23274 0.674072H13.2169C13.4733 0.674072 13.7297 0.783942 13.9128 0.967065L19.9192 6.97351C20.1024 7.15664 20.2123 7.41302 20.2123 7.66939V19.6457C20.2123 21.2938 18.8937 22.6489 17.209 22.6489ZM5.23274 2.68843C4.68337 2.68843 4.24385 3.12792 4.24385 3.67729V19.6457C4.24385 20.195 4.68337 20.6345 5.23274 20.6345H17.209C17.7584 20.6345 18.1979 20.195 18.1979 19.6457V8.07226L12.7774 2.6518H5.23274V2.68843Z"
                            fill="#3AC4A0"
                          />
                          <path
                            d="M19.2243 8.65825H13.2179C12.6685 8.65825 12.229 8.21876 12.229 7.66939V1.66293C12.229 1.11356 12.6685 0.674072 13.2179 0.674072C13.7672 0.674072 14.2067 1.11356 14.2067 1.66293V6.68052H19.1877C19.7371 6.68052 20.1765 7.12002 20.1765 7.66939C20.2132 8.21876 19.7737 8.65825 19.2243 8.65825Z"
                            fill="#3AC4A0"
                          />
                          <path
                            d="M15.2309 13.6755H7.24671C6.69734 13.6755 6.25781 13.236 6.25781 12.6866C6.25781 12.1372 6.69734 11.6978 7.24671 11.6978H15.2309C15.7802 11.6978 16.2198 12.1372 16.2198 12.6866C16.2198 13.1994 15.7802 13.6755 15.2309 13.6755Z"
                            fill="#3AC4A0"
                          />
                          <path
                            d="M15.2309 17.6679H7.24671C6.69734 17.6679 6.25781 17.2284 6.25781 16.679C6.25781 16.1297 6.69734 15.6902 7.24671 15.6902H15.2309C15.7802 15.6902 16.2198 16.1297 16.2198 16.679C16.2198 17.1918 15.7802 17.6679 15.2309 17.6679Z"
                            fill="#3AC4A0"
                          />
                          <path
                            d="M9.2264 9.64717H7.21204C6.66267 9.64717 6.22314 9.20766 6.22314 8.65829C6.22314 8.10892 6.66267 7.66943 7.21204 7.66943H9.2264C9.77577 7.66943 10.2152 8.10892 10.2152 8.65829C10.2519 9.20766 9.77577 9.64717 9.2264 9.64717Z"
                            fill="#3AC4A0"
                          />
                        </svg>
                        <h1 className="text-lg font-semibold text-white text-center">
                          {data.totalPost}
                        </h1>
                      </section>
                    </div>
                  </div>
                </div>
              );
            })
          ) : (
            <p>Not found</p>
          )}
        </>
      )}
    </>
  );
}
